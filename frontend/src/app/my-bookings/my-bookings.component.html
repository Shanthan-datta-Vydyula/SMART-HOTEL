<div class="container mt-4">
  <div class="header-section mb-4">
    <button class="back-btn" (click)="goBack()">
      <i class="bi bi-arrow-left"></i> Back to Hotel Search
    </button>
    <div class="header-content">
      <h1 class="text-primary">My Bookings</h1>
      <p class="text-muted">View and manage your hotel reservations</p>
    </div>
  </div>

  <div *ngIf="!isLoggedIn" class="alert alert-warning">
    <i class="bi bi-exclamation-triangle"></i>
    Please log in to view your bookings.
    <button class="btn btn-primary ms-2" (click)="goToLogin()">Login</button>
  </div>

  <div *ngIf="isLoggedIn && bookings == undefined" class="text-center py-5">
    <i class="bi bi-calendar-x text-muted" style="font-size: 4rem;"></i>
    <h3 class="text-muted mt-3">No bookings found</h3>
    <p class="text-muted">You haven't made any hotel bookings yet.</p>
    <button class="btn btn-primary" (click)="searchHotels()">
      <i class="bi bi-search"></i> Search Hotels
    </button>
  </div>

  <!-- Option 1: Using transformed bookings (Recommended) -->
  <div *ngIf="isLoggedIn && bookings != undefined" class="row">
    <div class="col-md-6 mb-4" *ngFor="let booking of bookings.bookings">
      <div class="card h-100 shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">{{ booking.hotelId.hotelName }}</h5>
          <span class="badge" [ngClass]="{
            'bg-success': booking.status === 'confirmed',
            'bg-warning': booking.status === 'pending',
            'bg-danger': booking.status === 'cancelled'
          }">
            {{ booking.status | titlecase }}
          </span>
        </div>
        <div class="card-body">
          <p class="card-text">
            <i class="bi bi-geo-alt text-primary"></i>
            <strong>Location:</strong> {{ booking.hotelId.address.street+", "+booking.hotelId.address.postalCode+ ", "+ booking.hotelId.address.city }}
          </p>
          <p class="card-text">
            <i class="bi bi-calendar-event text-success"></i>
            <strong>Check-in:</strong> {{ booking.startDate | date }}
          </p>
          <p class="card-text">
            <i class="bi bi-calendar-x text-danger"></i>
            <strong>Check-out:</strong> {{ booking.endDate | date }}
          </p>
          <p class="card-text">
            <i class="bi bi-currency-rupee text-info"></i>
            <strong>Price:</strong> ₹{{ booking.price }}
          </p>
          <p class="card-text">
            <small class="text-muted">
              <i class="bi bi-clock"></i>
              Booked on: {{ booking.hotelId.updatedAt | date }}
            </small>
          </p>
        </div>
        <div class="card-footer bg-transparent">
          <button class="btn btn-outline-success btn-sm me-2" (click)="openFeedback(booking)">
            <i class="bi bi-chat-left-text"></i> Feedback
          </button>
          <!-- <button *ngIf="booking.status === 'confirmed'" class="btn btn-outline-danger btn-sm" (click)="cancelBooking(booking)">
            Cancel
          </button> -->
        </div>
      </div>
  </div>
</div>

<!-- Feedback Modal -->
<div class="modal-overlay" *ngIf="showFeedbackModal" (click)="closeFeedbackModal()">
  <div class="feedback-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Submit Feedback</h3>
      <button type="button" class="close-btn" (click)="closeFeedbackModal()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    
    <div class="modal-body" *ngIf="selectedBooking">
      <div class="hotel-info">
        <h4>{{ selectedBooking.hotelId.hotelName }}</h4>
        <p class="text-muted">{{ selectedBooking.hotelId.address.city }}</p>
      </div>

      <form (ngSubmit)="submitFeedback(feedbackForm)" #feedbackForm="ngForm">
        <div class="rating-section">
          <label>Rating</label>
          <div class="star-rating">
            <span 
              *ngFor="let star of [1,2,3,4,5]" 
              class="star" 
              [class.filled]="star <= feedbackData.rating"
              (click)="setRating(star)">
              ★
            </span>
          </div>
          <small class="rating-text">{{ feedbackData.rating }} out of 5 stars</small>
        </div>

        <div class="comment-section">
          <label for="comment">Your Feedback</label>
          <textarea 
            id="comment"
            name="comment"
            [(ngModel)]="feedbackData.comment"
            placeholder="Share your experience with this hotel..."
            rows="4"
            required>
          </textarea>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeFeedbackModal()">
            Cancel
          </button>
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="!feedbackData.comment.trim()">
            Submit Feedback
          </button>
        </div>
      </form>
    </div>
  </div>
</div>  <!-- Option 2: Using raw booking data directly (Alternative approach) -->
  <!-- 
  <div *ngIf="isLoggedIn && getRawBookings().length > 0" class="row">
    <div class="col-md-6 mb-4" *ngFor="let rawBooking of getRawBookings()">
      <div class="card h-100 shadow-sm">
        <div class="card-header">
          <h5 class="mb-0">{{ rawBooking.hotelId?.hotelName }}</h5>
        </div>
        <div class="card-body">
          <p class="card-text">
            <strong>Location:</strong> {{ rawBooking.hotelId?.address?.city }}
          </p>
          <p class="card-text">
            <strong>Check-in:</strong> {{ rawBooking.startDate | date }}
          </p>
          <p class="card-text">
            <strong>Check-out:</strong> {{ rawBooking.endDate | date }}
          </p>
          <p class="card-text">
            <strong>Price:</strong> ₹{{ rawBooking.price }}
          </p>
        </div>
      </div>
    </div>
  </div>
  -->
</div>